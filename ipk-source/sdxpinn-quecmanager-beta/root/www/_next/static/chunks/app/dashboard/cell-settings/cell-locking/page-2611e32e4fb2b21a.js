(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5665],{5853:(e,t,s)=>{Promise.resolve().then(s.bind(s,43166))},43166:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var a=s(20475),l=s(20107),i=s(72167),r=s(35601),c=s(42541),n=s(76554),o=s(64219),d=s(49153),h=s(52744),m=s(29475),u=s(52161),g=s(97801),p=s(32857);let C=(0,s(39997).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var x=s(98969),N=s(96244);let w=e=>{let{loading:t,scheduling:s,startTime:r,endTime:c,onStartTimeChange:n,onEndTimeChange:m,onSchedulingToggle:u,locked:g}=e,[p,w]=(0,l.useState)({text:"Disabled",color:"text-red-600",icon:C}),v=()=>{if(!s){w({text:"Disabled",color:"text-red-600",icon:C});return}let e=new Date,t=60*e.getHours()+e.getMinutes(),[a,l]=r.split(":").map(Number),[i,n]=c.split(":").map(Number),o=60*a+l,d=60*i+n;o<=d?t>=o&&t<=d?w({text:"Active",color:"text-green-600",icon:x.A}):w({text:"Inactive",color:"text-yellow-500",icon:N.A}):t>=o||t<=d?w({text:"Active",color:"text-green-600",icon:x.A}):w({text:"Inactive",color:"text-yellow-500",icon:N.A})};(0,l.useEffect)(()=>{v();let e=setInterval(v,6e4);return()=>clearInterval(e)},[s,r,c]);let f=p.icon;return(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsxs)(i.ZB,{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsx)("span",{children:"Cell Locking Scheduler"})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(f,{className:"h-4 w-4 mr-1 ".concat(p.color)}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:p.text})]})]}),(0,a.jsx)(i.BT,{children:"Schedule the device to lock to specific cells at certain times."})]}),(0,a.jsx)(i.Wu,{children:(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 grid-cols-1 grid-flow-row gap-4",children:[(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"start-time",children:"Start Time"}),(0,a.jsx)(o.p,{type:"time",id:"start-time",value:r,onChange:e=>n(e.target.value),disabled:t||s,placeholder:"START TIME"})]}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"end-time",children:"End Time"}),(0,a.jsx)(o.p,{type:"time",id:"end-time",value:c,onChange:e=>m(e.target.value),disabled:t||s,placeholder:"END TIME"})]}),(0,a.jsx)("div",{className:"lg:col-span-2 col-span-1",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Make sure to properly set the timezone using Luci for this to properly work. The scheduler will lock the device to the selected cells during the specified time range. The scheduler will not lock the device if the time range is not valid (e.g. start time is after end time)."})})]})}),(0,a.jsx)(i.wL,{className:"border-t py-4",children:(0,a.jsxs)(h.l,{disabled:t||!r||!c||!g,pressed:s,onPressedChange:u,children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-2"}),s?"Disable":"Enable"," Scheduled Locking"]})})]})},v=()=>{let{toast:e}=(0,p.dj)(),[t,s]=(0,l.useState)(!1),[C,x]=(0,l.useState)(!1),[N,v]=(0,l.useState)(!1),[f,j]=(0,l.useState)(!1),[R,A]=(0,l.useState)(!1),[y,E]=(0,l.useState)(""),[b,P]=(0,l.useState)(""),[F,k]=(0,l.useState)({EARFCN1:"",PCI1:"",EARFCN2:"",PCI2:"",EARFCN3:"",PCI3:""}),[T,S]=(0,l.useState)({NRARFCN:"",NRPCI:"",SCS:"",NRBAND:""}),I=async e=>{let t=encodeURIComponent(e);try{let e=await fetch("/cgi-bin/atinout_handler.sh",{method:"POST",headers:{"Content-Type":"application/json"},body:"command=".concat(t)}),s=await e.json();if(!e.ok)throw Error(s.error||"Failed to execute AT command");return s}catch(e){if(e instanceof Error)throw Error("AT command failed: ".concat(e.message));throw Error("AT command failed with unknown error")}},L=e=>{let t=e.match(/\+QNWLOCK:\s*(.+?)\n/);return t?t[1].replace(/"/g,"").split(",").map(e=>e.trim()):null},O=async()=>{try{let e=await I('AT+QNWLOCK="save_ctrl"');if(e&&e.output){let t=L(e.output);console.log("Persist status:",t),t&&t.length>=2&&(v("1"===t[1]),j("1"===t[2]))}}catch(e){console.error("Error fetching persist status:",e)}},_=async()=>{try{s(!0),await O(),await new Promise(e=>setTimeout(e,1e3));let e=await I('AT+QNWLOCK="common/4g"');if(e&&e.output){let t=L(e.output);if(t){let e=parseInt(t[1]),s={EARFCN1:e>=1?t[2]:"",PCI1:e>=1?t[3]:"",EARFCN2:e>=2?t[4]:"",PCI2:e>=2?t[5]:"",EARFCN3:e>=3?t[6]:"",PCI3:e>=3?t[7]:""};k(s),e>0&&x(!0)}}let t=await I('AT+QNWLOCK="common/5g"');if(console.log("Current NR5G lock status:",t),t&&t.output){let e=L(t.output);if(e&&e.length>=5){let t={NRPCI:e[1],NRARFCN:e[2],SCS:e[3],NRBAND:e[4]};S(t),parseInt(e[1])>0&&x(!0)}}}catch(t){console.error("Error fetching current status:",t),e({title:"Error",description:"Failed to fetch current cell locking status",variant:"destructive"})}finally{s(!1)}},D=async t=>{try{if(s(!0),t&&(!y||!b))throw Error("Please set both start and end times");if(!(await fetch("/cgi-bin/cell-settings/scheduled_cell_locking.sh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t?"web=true&start_time=".concat(encodeURIComponent(y),"&end_time=").concat(encodeURIComponent(b)):"web=true&disable=true"})).ok)throw Error("Failed to update scheduling");A(t),e({title:"Success",description:t?"Cell locking schedule enabled":"Cell locking schedule disabled"})}catch(t){e({title:"Error",description:t instanceof Error?t.message:"Failed to update scheduling",variant:"destructive"})}finally{s(!1)}},W=async()=>{try{s(!0);let t=[];if(F.EARFCN1&&F.PCI1&&t.push([F.EARFCN1,F.PCI1]),F.EARFCN2&&F.PCI2&&t.push([F.EARFCN2,F.PCI2]),F.EARFCN3&&F.PCI3&&t.push([F.EARFCN3,F.PCI3]),0===t.length)throw Error("Please fill at least one EARFCN and PCI pair");let a='AT+QNWLOCK="common/4g",'.concat(t.length);t.forEach(e=>{let[t,s]=e;a+=",".concat(t,",").concat(s)}),await I(a),await new Promise(e=>setTimeout(e,1e3)),await I('AT+QNWLOCK="save_ctrl",1,0'),await _(),e({title:"Success",description:"LTE cells locked successfully with ".concat(t.length," pair").concat(t.length>1?"s":"")})}catch(t){s(!1),e({title:"Error",description:t instanceof Error?t.message:"Failed to lock LTE cells",variant:"destructive"})}},B=async()=>{try{if(s(!0),!T.NRPCI||!T.NRARFCN||!T.SCS||!T.NRBAND)throw Error("Please fill all NR5G fields");let t='AT+QNWLOCK="common/5g",'.concat(T.NRPCI,",").concat(T.NRARFCN,",").concat(T.SCS,",").concat(T.NRBAND);await I(t),await new Promise(e=>setTimeout(e,1e3)),await I('AT+QNWLOCK="save_ctrl",0,1'),await _(),e({title:"Success",description:"NR5G cell locked successfully"})}catch(t){s(!1),e({title:"Error",description:t instanceof Error?t.message:"Failed to lock NR5G cell",variant:"destructive"})}},K=async()=>{try{s(!0),await I('AT+QNWLOCK="common/4g",0'),await new Promise(e=>setTimeout(e,1e3)),await I('AT+QNWLOCK="save_ctrl",1,0'),await I("AT+COPS=2"),await new Promise(e=>setTimeout(e,2e3)),await I("AT+COPS=0"),await _(),e({title:"Success",description:"LTE cell locking reset to default"})}catch(t){s(!1),e({title:"Error",description:"Failed to reset LTE cell locking",variant:"destructive"})}},Q=async()=>{try{s(!0),await I('AT+QNWLOCK="common/5g",0'),await I('AT+QNWLOCK="save_ctrl",0,1'),await I("AT+COPS=2"),await new Promise(e=>setTimeout(e,2e3)),await I("AT+COPS=0"),await _(),e({title:"Success",description:"NR5G cell locking reset to default"})}catch(t){s(!1),e({title:"Error",description:"Failed to reset NR5G cell locking",variant:"destructive"})}},z=async t=>{try{s(!0),await I('AT+QNWLOCK="save_ctrl",'.concat(t?"1":"0",",").concat(f?"1":"0")),await O(),e({title:"Success",description:"LTE persist on boot ".concat(t?"enabled":"disabled")}),await new Promise(e=>setTimeout(e,2e3)),window.location.reload()}catch(t){e({title:"Error",description:"Failed to update LTE persist setting",variant:"destructive"})}finally{s(!1)}},G=async t=>{try{s(!0),await I('AT+QNWLOCK="save_ctrl",'.concat(N?"1":"0",",").concat(t?"1":"0")),await O(),e({title:"Success",description:"NR5G persist on boot ".concat(t?"enabled":"disabled")}),await new Promise(e=>setTimeout(e,2e3)),window.location.reload()}catch(t){e({title:"Error",description:"Failed to update NR5G persist setting",variant:"destructive"})}finally{s(!1)}};return(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/cgi-bin/cell-settings/scheduled_cell_locking.sh?status=true");if(e.ok){let t=await e.json();t.enabled&&(A(!0),E(t.start_time||""),P(t.end_time||""))}}catch(e){console.error("Failed to fetch schedule status:",e)}})(),_()},[]),(0,a.jsxs)("div",{className:"grid gap-6",children:[(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{children:"4G LTE Cellular Locking"}),(0,a.jsx)(i.BT,{children:"Lock the device to specific LTE Physical Cell IDs."})]}),(0,a.jsx)(i.Wu,{children:(0,a.jsxs)("form",{className:"grid lg:grid-cols-2 grid-cols-1 grid-flow-row gap-6",children:[(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"EARFCN1",children:"EARFCN 1"}),(0,a.jsx)(o.p,{type:"text",id:"EARFCN1",placeholder:"EARFCN 1",value:F.EARFCN1,onChange:e=>k(t=>({...t,EARFCN1:e.target.value}))})]}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"PCI1",children:"PCI 1"}),(0,a.jsx)(o.p,{type:"text",id:"PCI1",placeholder:"PCI 1",value:F.PCI1,onChange:e=>k(t=>({...t,PCI1:e.target.value}))})]}),(0,a.jsx)(n.w,{className:"my-1 col-span-2 w-full"}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"EARFCN2",children:"EARFCN 2"}),(0,a.jsx)(o.p,{type:"text",id:"EARFCN2",placeholder:"EARFCN 2",value:F.EARFCN2,onChange:e=>k(t=>({...t,EARFCN2:e.target.value}))})]}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"PCI2",children:"PCI 2"}),(0,a.jsx)(o.p,{type:"text",id:"PCI2",placeholder:"PCI 2",value:F.PCI2,onChange:e=>k(t=>({...t,PCI2:e.target.value}))})]}),(0,a.jsx)(n.w,{className:"my-1 col-span-2 w-full"}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"EARFCN3",children:"EARFCN 3"}),(0,a.jsx)(o.p,{type:"text",id:"EARFCN3",placeholder:"EARFCN 3",value:F.EARFCN3,onChange:e=>k(t=>({...t,EARFCN3:e.target.value}))})]}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"PCI3",children:"PCI 3"}),(0,a.jsx)(o.p,{type:"text",id:"PCI3",placeholder:"PCI 3",value:F.PCI3,onChange:e=>k(t=>({...t,PCI3:e.target.value}))})]})]})}),(0,a.jsxs)(i.wL,{className:"border-t py-4 grid grid-flow-row md:grid-cols-3 grid-cols-1 gap-4",children:[(0,a.jsxs)(c.$,{onClick:W,disabled:t||R,children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),"Lock LTE Cells"]}),(0,a.jsxs)(h.l,{pressed:N,onPressedChange:z,disabled:t,children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Persist on Reboot"]}),(0,a.jsxs)(c.$,{variant:"secondary",onClick:K,disabled:t||!C,children:[(0,a.jsx)(g.A,{className:"h-4 w-4"}),"Reset to Default"]})]})]}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{children:"NR5G-SA Cellular Locking"}),(0,a.jsx)(i.BT,{children:"Lock the device to a specific NR5G-SA Physical Cell ID."})]}),(0,a.jsx)(i.Wu,{children:(0,a.jsxs)("form",{className:"grid lg:grid-cols-2 grid-cols-1 grid-flow-row gap-6",children:[(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"NR-ARFCN",children:"NR ARFCN"}),(0,a.jsx)(o.p,{type:"text",id:"NR-ARFCN",placeholder:"NR ARFCN",value:T.NRARFCN,onChange:e=>S(t=>({...t,NRARFCN:e.target.value}))})]}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"NR-PCI",children:"NR PCI"}),(0,a.jsx)(o.p,{type:"text",id:"NR-PCI",placeholder:"NR PCI",value:T.NRPCI,onChange:e=>S(t=>({...t,NRPCI:e.target.value}))})]}),(0,a.jsx)(n.w,{className:"my-0.5 col-span-2 w-full"}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"SCS",children:"SCS"}),(0,a.jsxs)(r.l6,{value:T.SCS,onValueChange:e=>S(t=>({...t,SCS:e})),children:[(0,a.jsx)(r.bq,{id:"SCS",children:(0,a.jsx)(r.yv,{placeholder:"SCS"})}),(0,a.jsx)(r.gC,{children:(0,a.jsxs)(r.s3,{children:[(0,a.jsx)(r.TR,{children:"SCS"}),(0,a.jsx)(r.eb,{value:"15",children:"15 kHz"}),(0,a.jsx)(r.eb,{value:"30",children:"30 kHz"}),(0,a.jsx)(r.eb,{value:"60",children:"60 kHz"}),(0,a.jsx)(r.eb,{value:"120",children:"120 kHz"}),(0,a.jsx)(r.eb,{value:"240",children:"240 kHz"})]})})]})]}),(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"NRBAND",children:"NR Band"}),(0,a.jsx)(o.p,{type:"text",id:"NRBAND",placeholder:"NR BAND",value:T.NRBAND,onChange:e=>S(t=>({...t,NRBAND:e.target.value}))})]})]})}),(0,a.jsxs)(i.wL,{className:"border-t py-4 grid grid-flow-row md:grid-cols-3 grid-cols-1 gap-4",children:[(0,a.jsxs)(c.$,{onClick:B,disabled:t||R,children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),"Lock NR5G-SA Cell"]}),(0,a.jsxs)(h.l,{pressed:f,onPressedChange:G,disabled:t,children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Persist on Reboot"]}),(0,a.jsxs)(c.$,{variant:"secondary",onClick:Q,disabled:t||!C,children:[(0,a.jsx)(g.A,{className:"h-4 w-4"}),"Reset to Default"]})]})]}),(0,a.jsx)(w,{loading:t,scheduling:R,startTime:y,endTime:b,onStartTimeChange:E,onEndTimeChange:P,onSchedulingToggle:D,locked:C})]})}},52744:(e,t,s)=>{"use strict";s.d(t,{l:()=>m});var a=s(20475),l=s(20107),i=s(94521),r=s(81255),c=s(4589),n=l.forwardRef((e,t)=>{let{pressed:s,defaultPressed:l=!1,onPressedChange:n,...o}=e,[d=!1,h]=(0,r.i)({prop:s,onChange:n,defaultProp:l});return(0,a.jsx)(c.sG.button,{type:"button","aria-pressed":d,"data-state":d?"on":"off","data-disabled":e.disabled?"":void 0,...o,ref:t,onClick:(0,i.m)(e.onClick,()=>{e.disabled||h(!d)})})});n.displayName="Toggle";var o=s(29395),d=s(22250);let h=(0,o.F)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),m=l.forwardRef((e,t)=>{let{className:s,variant:l,size:i,...r}=e;return(0,a.jsx)(n,{ref:t,className:(0,d.cn)(h({variant:l,size:i,className:s})),...r})});m.displayName=n.displayName},98969:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(39997).A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},96244:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(39997).A)("Clock1",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 14.5 8",key:"12zbmj"}]])},29475:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(39997).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},97801:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(39997).A)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[9980,7780,1617,5011,4673,2301,6152,191,6035,7358],()=>t(5853)),_N_E=e.O()}]);