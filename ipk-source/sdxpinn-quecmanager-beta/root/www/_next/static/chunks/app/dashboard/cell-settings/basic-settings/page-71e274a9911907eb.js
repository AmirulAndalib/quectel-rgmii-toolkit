(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2545],{58669:(e,r,l)=>{Promise.resolve().then(l.bind(l,8016))},8016:(e,r,l)=>{"use strict";l.r(r),l.d(r,{default:()=>S});var i=l(20475),t=l(20107),s=l(72167),n=l(35601),o=l(42541),a=l(64219),c=l(49153),d=l(36760),p=l(32857);let u=()=>{let[e,r]=(0,t.useState)(null),[l,i]=(0,t.useState)(!0),s=(0,t.useCallback)(async()=>{try{i(!0),r(null);let e=await fetch("/cgi-bin/fetch_data.sh?set=2"),l=await e.json();console.log("Fetched cell settings data:",l);let t={currentAPN:f(l[0].response,l[1].response),apnPDPType:h(l[0].response),preferredNetworkType:v(l[2].response),nr5gMode:P(l[3].response),simSlot:g(l[4].response)};r(t),console.log("Processed cell settings data:",t)}catch(e){console.error("Error fetching cell settings data:",e)}i(!1)},[]);return(0,t.useEffect)(()=>{s()},[s]),{data:e,isLoading:l,fetchCellSettingsData:s}},f=(e,r)=>{var l,i;let t=null===(l=e.split("\n").find(e=>e.includes("+CGDCONT: 1")))||void 0===l?void 0:l.split(",")[2].replace(/"/g,"");if(void 0===t||""===t){let e=null===(i=r.split("\n").find(e=>e.includes("+CGCONTRDP:")))||void 0===i?void 0:i.split(",")[2].replace(/"/g,"");return void 0===e||""===e?"No APN found":e}return t},h=e=>{var r;let l=null===(r=e.split("\n").find(e=>e.includes("+CGDCONT: 1")))||void 0===r?void 0:r.split(",")[1].replace(/"/g,"");return void 0===l||""===l?"Error fetching PDP Type":l},v=e=>{var r;let l=null===(r=e.split("\n").find(e=>e.includes('+QNWPREFCFG: "mode_pref"')))||void 0===r?void 0:r.split(",")[1].replace(/"/g,"");return void 0===l||""===l?"Error fetching network type":l},P=e=>{var r;let l=null===(r=e.split("\n").find(e=>e.includes('+QNWPREFCFG: "nr5g_disable_mode"')))||void 0===r?void 0:r.split(",")[1].replace(/"/g,"");return void 0===l||""===l?"Error fetching NR5G mode":l},g=e=>{var r;let l=null===(r=e.split("\n").find(e=>e.includes("+QUIMSLOT:")))||void 0===r?void 0:r.split(":")[1].trim();return void 0===l||""===l?"Error fetching SIM slot":l};var y=l(76554),m=l(52161),x=l(51873);let j={apn:"",pdpType:"",iccid:""},N={profile1:{...j},profile2:{...j}},T=[{value:"IPV4",label:"IPv4 Only"},{value:"IPV6",label:"IPv6 Only"},{value:"IPV4V6",label:"IPv4 and IPv6"},{value:"P2P",label:"P2P Protocol"}],w=()=>{let{toast:e}=(0,p.dj)(),{profiles:r,isLoading:l,updateAPNProfile:u,deleteAPNProfiles:f}=function(){let[e,r]=(0,t.useState)({}),[l,i]=(0,t.useState)(!0),s=async()=>{try{i(!0);let e=await fetch("/cgi-bin/cell-settings/apn-profiles/fetch-profile.sh",{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"},signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let l=await e.json();console.log("Fetched APN profiles data:",l),r(l)}catch(e){console.error("Error fetching APN profiles:",e)}finally{i(!1)}};(0,t.useEffect)(()=>{s()},[]);let n=async(l,i)=>{try{var t,s,n,o,a,c;let d=new URLSearchParams;"profile1"===l?(d.append("iccidProfile1",i.iccid),d.append("apnProfile1",i.apn),d.append("pdpType1",i.pdpType)):(d.append("iccidProfile1",(null===(t=e.profile1)||void 0===t?void 0:t.iccid)||""),d.append("apnProfile1",(null===(s=e.profile1)||void 0===s?void 0:s.apn)||""),d.append("pdpType1",(null===(n=e.profile1)||void 0===n?void 0:n.pdpType)||"")),("profile2"===l||e.profile2)&&(d.append("iccidProfile2","profile2"===l?i.iccid:(null===(o=e.profile2)||void 0===o?void 0:o.iccid)||""),d.append("apnProfile2","profile2"===l?i.apn:(null===(a=e.profile2)||void 0===a?void 0:a.apn)||""),d.append("pdpType2","profile2"===l?i.pdpType:(null===(c=e.profile2)||void 0===c?void 0:c.pdpType)||""));let p=await fetch("/cgi-bin/cell-settings/apn-profiles/save-profile.sh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString(),signal:AbortSignal.timeout(15e3)});if(!p.ok)throw Error("Failed to update profile");let u=await p.json();if("success"===u.status)return r(e=>({...e,[l]:i})),!0;throw Error(u.message||"Failed to update profile")}catch(e){return console.error("Error updating ".concat(l,":"),e),!1}};return{profiles:e,isLoading:l,updateAPNProfile:n,deleteAPNProfiles:async()=>{try{let e=await fetch("/cgi-bin/cell-settings/apn-profiles/delete-profile.sh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error("Failed to delete profiles");let l=await e.json();if("success"===l.status)return r({}),!0;throw Error(l.message||"Failed to delete profiles")}catch(e){return console.error("Error deleting APN profiles:",e),!1}}}}(),[h,v]=(0,t.useState)(!1),[P,g]=(0,t.useState)(!1),[j,w]=(0,t.useState)(N);(0,t.useEffect)(()=>{if(r){var e,l,i,t,s,n;w({profile1:{apn:(null===(e=r.profile1)||void 0===e?void 0:e.apn)||"",pdpType:(null===(l=r.profile1)||void 0===l?void 0:l.pdpType)||"",iccid:(null===(i=r.profile1)||void 0===i?void 0:i.iccid)||""},profile2:{apn:(null===(t=r.profile2)||void 0===t?void 0:t.apn)||"",pdpType:(null===(s=r.profile2)||void 0===s?void 0:s.pdpType)||"",iccid:(null===(n=r.profile2)||void 0===n?void 0:n.iccid)||""}})}},[r]);let S=(e,r,l)=>{w(i=>({...i,[e]:{...i[e],[r]:l}}))},A=()=>j.profile1.apn&&j.profile1.pdpType&&j.profile1.iccid?!Object.values(j.profile2).some(e=>""!==e)||!!j.profile2.apn&&!!j.profile2.pdpType&&!!j.profile2.iccid||(e({variant:"destructive",title:"Invalid Profile 2",description:"All fields for Profile 2 are required if any field is filled"}),!1):(e({variant:"destructive",title:"Invalid Profile 1",description:"All fields for Profile 1 are required"}),!1),b=async r=>{if(r.preventDefault(),A()){v(!0);try{let r=await u("profile1",j.profile1),l=!Object.values(j.profile2).some(e=>""!==e)||await u("profile2",j.profile2);if(r&&l)e({title:"Success",description:"APN profiles have been saved successfully"});else throw Error("Failed to save one or more profiles")}catch(r){e({variant:"destructive",title:"Error",description:"Failed to save APN profiles. Please try again."})}finally{v(!1)}}},C=async()=>{if(confirm("Are you sure you want to delete all APN profiles?")){g(!0);try{if(await f())w(N),e({title:"Success",description:"APN profiles have been deleted successfully"});else throw Error("Failed to delete profiles")}catch(r){e({variant:"destructive",title:"Error",description:"Failed to delete APN profiles. Please try again."})}finally{g(!1)}}},E=(e,r)=>{var t;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsxs)(c.J,{htmlFor:"APNProfile".concat(r),children:["APN Profile ",r]}),l?(0,i.jsx)(d.E,{className:"h-8"}):(0,i.jsx)(a.p,{type:"text",id:"APNProfile".concat(r),placeholder:"APN for Profile ".concat(r),value:j[e].apn,onChange:r=>S(e,"apn",r.target.value)})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c.J,{htmlFor:"PDPType".concat(r),children:"APN PDP Type"}),l?(0,i.jsx)(d.E,{className:"h-8"}):(0,i.jsxs)(n.l6,{defaultValue:j[e].pdpType,value:j[e].pdpType,onValueChange:r=>S(e,"pdpType",r),children:[(0,i.jsx)(n.bq,{id:"PDPType".concat(r),children:(0,i.jsx)(n.yv,{placeholder:"Select PDP Type",children:(null===(t=T.find(r=>r.value===j[e].pdpType))||void 0===t?void 0:t.label)||"Select PDP Type"})}),(0,i.jsx)(n.gC,{children:(0,i.jsxs)(n.s3,{children:[(0,i.jsx)(n.TR,{children:"PDP Type"}),T.map(e=>{let{value:r,label:l}=e;return(0,i.jsx)(n.eb,{value:r,children:l},r)})]})})]})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2 col-span-2",children:[(0,i.jsxs)(c.J,{htmlFor:"ICCIDProfile".concat(r),children:["ICCID Profile ",r]}),l?(0,i.jsx)(d.E,{className:"h-8"}):(0,i.jsx)(a.p,{type:"text",id:"ICCIDProfile".concat(r),placeholder:"ICCID for Profile ".concat(r),value:j[e].iccid,onChange:r=>S(e,"iccid",r.target.value)})]})]})};return(0,i.jsxs)(s.Zp,{children:[(0,i.jsxs)(s.aR,{children:[(0,i.jsx)(s.ZB,{children:"APN and ICCID Profiles"}),(0,i.jsx)(s.BT,{children:"Configure APN profiles based on SIM card ICCID. Profile 1 is required."})]}),(0,i.jsx)(s.Wu,{children:(0,i.jsxs)("form",{className:"grid grid-cols-1 lg:grid-cols-2 grid-flow-row gap-6",onSubmit:b,children:[E("profile1",1),(0,i.jsx)(y.w,{className:"col-span-2 w-full my-2"}),E("profile2",2),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsxs)(s.wL,{className:"border-t py-4 grid md:grid-cols-2 grid-cols-1 gap-4 px-0",children:[(0,i.jsxs)(o.$,{type:"submit",disabled:h||P,children:[(0,i.jsx)(m.A,{className:"h-4 w-4"}),h?"Saving...":"Save Profiles"]}),(0,i.jsxs)(o.$,{type:"button",variant:"secondary",onClick:C,disabled:h||P,children:[(0,i.jsx)(x.A,{className:"h-4 w-4"}),P?"Deleting...":"Delete All Profiles"]})]})})]})})]})},S=()=>{let{toast:e}=(0,p.dj)(),{data:r,isLoading:l,fetchCellSettingsData:f}=u(),[h,v]=(0,t.useState)(!1),[P,g]=(0,t.useState)(!1),[y,m]=(0,t.useState)({currentAPN:"",apnPDPType:"",preferredNetworkType:"",nr5gMode:"",simSlot:""});(0,t.useEffect)(()=>{r&&!P&&(m({currentAPN:String(r.currentAPN||""),apnPDPType:String(r.apnPDPType||""),preferredNetworkType:String(r.preferredNetworkType||""),nr5gMode:String(r.nr5gMode||""),simSlot:String(r.simSlot||"")}),g(!0))},[r,P]),(0,t.useEffect)(()=>{r||g(!1)},[r]);let x=e=>{let r=[];if(e.currentAPN||e.apnPDPType){let l=e.apnPDPType||y.apnPDPType,i=e.currentAPN||y.currentAPN;r.push('AT+CGDCONT=1,"'.concat(l,'","').concat(i,'"'))}if(e.preferredNetworkType){let l='+QNWPREFCFG="mode_pref",'.concat(e.preferredNetworkType);r.push(0===r.length?"AT".concat(l):l)}if(e.nr5gMode){let l='+QNWPREFCFG="nr5g_disable_mode",'.concat(e.nr5gMode);r.push(0===r.length?"AT".concat(l):l)}if(e.simSlot){let l="+QUIMSLOT=".concat(e.simSlot,";+COPS=2;+COPS=0");r.push(0===r.length?"AT".concat(l):l)}return r.join(";")},j=(e,r)=>{m(l=>({...l,[e]:r}))},N=async()=>{try{let r=await fetch("/cgi-bin/settings/force-rerun.sh"),l=await r.json();if("success"===l.status)e({title:"Scripts Restarted",description:"Scripts have been restarted successfully"});else if("info"===l.status)e({title:"Info",description:"No scripts were found to restart"});else throw Error("Failed to restart scripts")}catch(r){console.error("Error rerunning scripts:",r),e({variant:"destructive",title:"Script Restart Failed",description:"Failed to restart the required scripts"})}},T=async l=>{l.preventDefault(),v(!0);try{let l={};if(Object.keys(y).forEach(e=>{y[e]!==(null==r?void 0:r[e])&&(l[e]=y[e])}),0===Object.keys(l).length){e({title:"No changes detected",description:"Try changing some settings before saving"});return}let i=x(l),t=encodeURIComponent(i);if(!(await fetch("/cgi-bin/at_command.sh?command=".concat(t),{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(5e3)})).ok)throw Error("Failed to save settings");await new Promise(e=>setTimeout(e,1500)),await f(),g(!1),e({title:"Settings saved!",description:"The settings have been saved successfully",duration:3e3}),l.simSlot&&setTimeout(()=>{N()},3100)}catch(r){console.error("Error saving settings:",r),e({variant:"destructive",title:"Failed to save settings!",description:"An error occurred while saving the settings"})}finally{v(!1)}};return(0,i.jsxs)("div",{className:"grid grid-cols-1 grid-flow-row gap-8",children:[(0,i.jsx)(s.Zp,{children:(0,i.jsxs)("form",{onSubmit:T,children:[(0,i.jsxs)(s.aR,{children:[(0,i.jsx)(s.ZB,{children:"Network Settings"}),(0,i.jsx)(s.BT,{children:"Change the network settings of the device."})]}),(0,i.jsx)(s.Wu,{children:(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 grid-flow-row gap-6",children:[(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c.J,{htmlFor:"APN",children:"Current APN"}),l?(0,i.jsx)(d.E,{className:"h-8"}):(0,i.jsx)(a.p,{type:"text",id:"APN",placeholder:"Current APN",value:y.currentAPN,onChange:e=>j("currentAPN",e.target.value)})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c.J,{htmlFor:"APN",children:"APN PDP Type"}),l?(0,i.jsx)(d.E,{className:"h-8"}):(0,i.jsxs)(n.l6,{value:y.apnPDPType,onValueChange:e=>j("apnPDPType",e),children:[(0,i.jsx)(n.bq,{children:(0,i.jsx)(n.yv,{children:y.apnPDPType?(e=>({IPV4:"IPv4 Only",IPV6:"IPv6 Only",IPV4V6:"IPv4 and IPv6",P2P:"P2P Protocol"})[e]||e)(y.apnPDPType):"Select PDP Type"})}),(0,i.jsx)(n.gC,{children:(0,i.jsxs)(n.s3,{children:[(0,i.jsx)(n.TR,{children:"PDP Type"}),(0,i.jsx)(n.eb,{value:"IPV4",children:"IPv4 Only"}),(0,i.jsx)(n.eb,{value:"IPV6",children:"IPv6 Only"}),(0,i.jsx)(n.eb,{value:"IPV4V6",children:"IPv4 and IPv6"}),(0,i.jsx)(n.eb,{value:"P2P",children:"P2P Protocol"})]})})]},"pdp-type-".concat(y.apnPDPType))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c.J,{children:"Preferred Network Type"}),l?(0,i.jsx)(d.E,{className:"h-8"}):(0,i.jsxs)(n.l6,{value:y.preferredNetworkType,onValueChange:e=>j("preferredNetworkType",e),children:[(0,i.jsx)(n.bq,{children:(0,i.jsx)(n.yv,{children:y.preferredNetworkType?(e=>({AUTO:"Automatic",LTE:"LTE Only","LTE:NR5G":"NR5G-NSA",NR5G:"NR5G-SA"})[e]||e)(y.preferredNetworkType):"Select Network Type"})}),(0,i.jsx)(n.gC,{children:(0,i.jsxs)(n.s3,{children:[(0,i.jsx)(n.TR,{children:"Preferred Network Type"}),(0,i.jsx)(n.eb,{value:"AUTO",children:"Automatic"}),(0,i.jsx)(n.eb,{value:"LTE",children:"LTE Only"}),(0,i.jsx)(n.eb,{value:"LTE:NR5G",children:"NR5G-NSA"}),(0,i.jsx)(n.eb,{value:"NR5G",children:"NR5G-SA"})]})})]},"network-type-".concat(y.preferredNetworkType))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c.J,{children:"NR5G Mode Control"}),l?(0,i.jsx)(d.E,{className:"h-8"}):(0,i.jsxs)(n.l6,{value:y.nr5gMode,onValueChange:e=>j("nr5gMode",e),children:[(0,i.jsx)(n.bq,{children:(0,i.jsx)(n.yv,{children:y.nr5gMode?(e=>({0:"NR5G-SA and NSA Enabled",1:"NR5G-NSA Only",2:"NR5G-SA Only"})[e]||e)(y.nr5gMode):"Select NR5G Mode"})}),(0,i.jsx)(n.gC,{children:(0,i.jsxs)(n.s3,{children:[(0,i.jsx)(n.TR,{children:"NR5G Mode"}),(0,i.jsx)(n.eb,{value:"0",children:"NR5G-SA and NSA Enabled"}),(0,i.jsx)(n.eb,{value:"1",children:"NR5G-NSA Only"}),(0,i.jsx)(n.eb,{value:"2",children:"NR5G-SA Only"})]})})]},"nr5g-mode-".concat(y.nr5gMode))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c.J,{children:"U-SIM Slot Configuration"}),l?(0,i.jsx)(d.E,{className:"h-8"}):(0,i.jsxs)(n.l6,{value:y.simSlot,onValueChange:e=>j("simSlot",e),children:[(0,i.jsx)(n.bq,{children:(0,i.jsx)(n.yv,{children:y.simSlot?"U-SIM Slot ".concat(y.simSlot):"Select U-SIM Slot"})}),(0,i.jsx)(n.gC,{children:(0,i.jsxs)(n.s3,{children:[(0,i.jsx)(n.TR,{children:"U-SIM Slot"}),(0,i.jsx)(n.eb,{value:"1",children:"U-SIM Slot 1"}),(0,i.jsx)(n.eb,{value:"2",children:"U-SIM Slot 2"})]})})]},"sim-slot-".concat(y.simSlot))]})]})}),(0,i.jsx)(s.wL,{className:"grid border-t py-4",children:(0,i.jsx)(o.$,{type:"submit",disabled:h,children:h?"Saving...":"Save"})})]})}),(0,i.jsx)(w,{})]})}},36760:(e,r,l)=>{"use strict";l.d(r,{E:()=>s});var i=l(20475),t=l(22250);function s(e){let{className:r,...l}=e;return(0,i.jsx)("div",{className:(0,t.cn)("animate-pulse rounded-md bg-primary/10",r),...l})}},51873:(e,r,l)=>{"use strict";l.d(r,{A:()=>i});let i=(0,l(39997).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},e=>{var r=r=>e(e.s=r);e.O(0,[9980,7780,1617,5011,4673,1457,6152,191,6035,7358],()=>r(58669)),_N_E=e.O()}]);