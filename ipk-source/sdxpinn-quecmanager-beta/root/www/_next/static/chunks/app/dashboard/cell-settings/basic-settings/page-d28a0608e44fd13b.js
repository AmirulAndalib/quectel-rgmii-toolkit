(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{51437:function(e,r,l){Promise.resolve().then(l.bind(l,80887))},80887:function(e,r,l){"use strict";l.r(r),l.d(r,{default:function(){return T}});var i=l(20881),t=l(64149),s=l(94920),n=l(22989),o=l(78580),a=l(33335),c=l(21501),d=l(88766),p=l(46646),u=()=>{let[e,r]=(0,t.useState)(null),[l,i]=(0,t.useState)(!0),s=(0,t.useCallback)(async()=>{try{i(!0);let e=await fetch("/cgi-bin/fetch_data.sh?set=2"),l=await e.json();console.log("Fetched cell settings data:",l);let t={currentAPN:f(l[0].response,l[1].response),apnPDPType:h(l[0].response),preferredNetworkType:P(l[2].response),nr5gMode:v(l[3].response),simSlot:g(l[4].response)};r(t),console.log("Processed cell settings data:",t)}catch(e){console.error("Error fetching cell settings data:",e)}i(!1)},[]);return(0,t.useEffect)(()=>{s()},[s]),{data:e,isLoading:l,fetchCellSettingsData:s}};let f=(e,r)=>{var l,i;let t=null===(l=e.split("\n").find(e=>e.includes("+CGDCONT: 1")))||void 0===l?void 0:l.split(",")[2].replace(/"/g,"");if(void 0===t||""===t){let e=null===(i=r.split("\n").find(e=>e.includes("+CGCONTRDP:")))||void 0===i?void 0:i.split(",")[2].replace(/"/g,"");return void 0===e||""===e?"No APN found":e}return t},h=e=>{var r;let l=null===(r=e.split("\n").find(e=>e.includes("+CGDCONT: 1")))||void 0===r?void 0:r.split(",")[1].replace(/"/g,"");return void 0===l||""===l?"Error fetching PDP Type":l},P=e=>{var r;let l=null===(r=e.split("\n").find(e=>e.includes('+QNWPREFCFG: "mode_pref"')))||void 0===r?void 0:r.split(",")[1].replace(/"/g,"");return void 0===l||""===l?"Error fetching network type":l},v=e=>{var r;let l=null===(r=e.split("\n").find(e=>e.includes('+QNWPREFCFG: "nr5g_disable_mode"')))||void 0===r?void 0:r.split(",")[1].replace(/"/g,"");return void 0===l||""===l?"Error fetching NR5G mode":l},g=e=>{var r;let l=null===(r=e.split("\n").find(e=>e.includes("+QUIMSLOT:")))||void 0===r?void 0:r.split(":")[1].trim();return void 0===l||""===l?"Error fetching SIM slot":l};var y=l(47657),x=l(24052),m=l(36306);let N={apn:"",pdpType:"",iccid:""},j={profile1:{...N},profile2:{...N}},w=[{value:"IPV4",label:"IPv4 Only"},{value:"IPV6",label:"IPv6 Only"},{value:"IPV4V6",label:"IPv4 and IPv6"},{value:"P2P",label:"P2P Protocol"}];var S=()=>{let{toast:e}=(0,p.pm)(),{profiles:r,isLoading:l,updateAPNProfile:u,deleteAPNProfiles:f}=function(){let[e,r]=(0,t.useState)({}),[l,i]=(0,t.useState)(!0),s=async()=>{try{i(!0);let e=await fetch("/cgi-bin/cell-settings/apn-profiles/fetch-profile.sh",{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"},signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let l=await e.json();console.log("Fetched APN profiles data:",l),r(l)}catch(e){console.error("Error fetching APN profiles:",e)}finally{i(!1)}};(0,t.useEffect)(()=>{s()},[]);let n=async(l,i)=>{try{var t,s,n,o,a,c;let d=new URLSearchParams;"profile1"===l?(d.append("iccidProfile1",i.iccid),d.append("apnProfile1",i.apn),d.append("pdpType1",i.pdpType)):(d.append("iccidProfile1",(null===(t=e.profile1)||void 0===t?void 0:t.iccid)||""),d.append("apnProfile1",(null===(s=e.profile1)||void 0===s?void 0:s.apn)||""),d.append("pdpType1",(null===(n=e.profile1)||void 0===n?void 0:n.pdpType)||"")),("profile2"===l||e.profile2)&&(d.append("iccidProfile2","profile2"===l?i.iccid:(null===(o=e.profile2)||void 0===o?void 0:o.iccid)||""),d.append("apnProfile2","profile2"===l?i.apn:(null===(a=e.profile2)||void 0===a?void 0:a.apn)||""),d.append("pdpType2","profile2"===l?i.pdpType:(null===(c=e.profile2)||void 0===c?void 0:c.pdpType)||""));let p=await fetch("/cgi-bin/cell-settings/apn-profiles/save-profile.sh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString(),signal:AbortSignal.timeout(1e4)});if(!p.ok)throw Error("Failed to update profile");let u=await p.json();if("success"===u.status)return r(e=>({...e,[l]:i})),!0;throw Error(u.message||"Failed to update profile")}catch(e){return console.error("Error updating ".concat(l,":"),e),!1}};return{profiles:e,isLoading:l,updateAPNProfile:n,deleteAPNProfiles:async()=>{try{let e=await fetch("/cgi-bin/cell-settings/apn-profiles/delete-profile.sh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error("Failed to delete profiles");let l=await e.json();if("success"===l.status)return r({}),!0;throw Error(l.message||"Failed to delete profiles")}catch(e){return console.error("Error deleting APN profiles:",e),!1}}}}(),[h,P]=(0,t.useState)(!1),[v,g]=(0,t.useState)(!1),[N,S]=(0,t.useState)(j);(0,t.useEffect)(()=>{if(r){var e,l,i,t,s,n;S({profile1:{apn:(null===(e=r.profile1)||void 0===e?void 0:e.apn)||"",pdpType:(null===(l=r.profile1)||void 0===l?void 0:l.pdpType)||"",iccid:(null===(i=r.profile1)||void 0===i?void 0:i.iccid)||""},profile2:{apn:(null===(t=r.profile2)||void 0===t?void 0:t.apn)||"",pdpType:(null===(s=r.profile2)||void 0===s?void 0:s.pdpType)||"",iccid:(null===(n=r.profile2)||void 0===n?void 0:n.iccid)||""}})}},[r]);let T=(e,r,l)=>{S(i=>({...i,[e]:{...i[e],[r]:l}}))},A=()=>N.profile1.apn&&N.profile1.pdpType&&N.profile1.iccid?!Object.values(N.profile2).some(e=>""!==e)||!!N.profile2.apn&&!!N.profile2.pdpType&&!!N.profile2.iccid||(e({variant:"destructive",title:"Invalid Profile 2",description:"All fields for Profile 2 are required if any field is filled"}),!1):(e({variant:"destructive",title:"Invalid Profile 1",description:"All fields for Profile 1 are required"}),!1),I=async r=>{if(r.preventDefault(),A()){P(!0);try{let r=await u("profile1",N.profile1),l=!Object.values(N.profile2).some(e=>""!==e)||await u("profile2",N.profile2);if(r&&l)e({title:"Success",description:"APN profiles have been saved successfully"});else throw Error("Failed to save one or more profiles")}catch(r){e({variant:"destructive",title:"Error",description:"Failed to save APN profiles. Please try again."})}finally{P(!1)}}},C=async()=>{if(confirm("Are you sure you want to delete all APN profiles?")){g(!0);try{if(await f())S(j),e({title:"Success",description:"APN profiles have been deleted successfully"});else throw Error("Failed to delete profiles")}catch(r){e({variant:"destructive",title:"Error",description:"Failed to delete APN profiles. Please try again."})}finally{g(!1)}}},b=(e,r)=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsxs)(c._,{htmlFor:"APNProfile".concat(r),children:["APN Profile ",r]}),l?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsx)(a.I,{type:"text",id:"APNProfile".concat(r),placeholder:"APN for Profile ".concat(r),value:N[e].apn,onChange:r=>T(e,"apn",r.target.value)})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{htmlFor:"PDPType".concat(r),children:"APN PDP Type"}),l?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(n.Ph,{value:N[e].pdpType,onValueChange:r=>T(e,"pdpType",r),children:[(0,i.jsx)(n.i4,{id:"PDPType".concat(r),children:(0,i.jsx)(n.ki,{placeholder:"Select PDP Type"})}),(0,i.jsx)(n.Bw,{children:(0,i.jsxs)(n.DI,{children:[(0,i.jsx)(n.n5,{children:"PDP Type"}),w.map(e=>{let{value:r,label:l}=e;return(0,i.jsx)(n.Ql,{value:r,children:l},r)})]})})]})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2 col-span-2",children:[(0,i.jsxs)(c._,{htmlFor:"ICCIDProfile".concat(r),children:["ICCID Profile ",r]}),l?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsx)(a.I,{type:"text",id:"ICCIDProfile".concat(r),placeholder:"ICCID for Profile ".concat(r),value:N[e].iccid,onChange:r=>T(e,"iccid",r.target.value)})]})]});return(0,i.jsxs)(s.Zb,{children:[(0,i.jsxs)(s.Ol,{children:[(0,i.jsx)(s.ll,{children:"APN and ICCID Profiles"}),(0,i.jsx)(s.SZ,{children:"Configure APN profiles based on SIM card ICCID. Profile 1 is required."})]}),(0,i.jsx)(s.aY,{children:(0,i.jsxs)("form",{className:"grid grid-cols-1 lg:grid-cols-2 grid-flow-row gap-6",onSubmit:I,children:[b("profile1",1),(0,i.jsx)(y.Z,{className:"col-span-2 w-full my-2"}),b("profile2",2),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsxs)(s.eW,{className:"border-t py-4 grid md:grid-cols-2 grid-cols-1 gap-4 px-0",children:[(0,i.jsxs)(o.z,{type:"submit",disabled:h||v,children:[(0,i.jsx)(x.Z,{className:"h-4 w-4"}),h?"Saving...":"Save Profiles"]}),(0,i.jsxs)(o.z,{type:"button",variant:"secondary",onClick:C,disabled:h||v,children:[(0,i.jsx)(m.Z,{className:"h-4 w-4"}),v?"Deleting...":"Delete All Profiles"]})]})})]})})]})},T=()=>{var e,r,l;let{toast:f}=(0,p.pm)(),{data:h,isLoading:P,fetchCellSettingsData:v}=u(),[g,y]=(0,t.useState)(!1),[x,m]=(0,t.useState)(!1),[N,j]=(0,t.useState)({currentAPN:"",apnPDPType:"",preferredNetworkType:"",nr5gMode:"",simSlot:""});(0,t.useEffect)(()=>{h&&!x&&(j({currentAPN:String(h.currentAPN||""),apnPDPType:String(h.apnPDPType||""),preferredNetworkType:String(h.preferredNetworkType||""),nr5gMode:String(h.nr5gMode||""),simSlot:String(h.simSlot||"")}),m(!0))},[h,x]),(0,t.useEffect)(()=>{h||m(!1)},[h]);let w=e=>{let r=[];if(e.currentAPN||e.apnPDPType){let l=e.apnPDPType||N.apnPDPType,i=e.currentAPN||N.currentAPN;r.push('AT+CGDCONT=1,"'.concat(l,'","').concat(i,'"'))}if(e.preferredNetworkType){let l='+QNWPREFCFG="mode_pref",'.concat(e.preferredNetworkType);r.push(0===r.length?"AT".concat(l):l)}if(e.nr5gMode){let l='+QNWPREFCFG="nr5g_disable_mode",'.concat(e.nr5gMode);r.push(0===r.length?"AT".concat(l):l)}if(e.simSlot){let l="+QUIMSLOT=".concat(e.simSlot,";+COPS=2;+COPS=0");r.push(0===r.length?"AT".concat(l):l)}return r.join(";")},T=(e,r)=>{j(l=>({...l,[e]:r}))},A=async()=>{try{let e=await fetch("/cgi-bin/settings/force-rerun.sh"),r=await e.json();if("success"===r.status)f({title:"Scripts Restarted",description:r.message});else throw Error("Failed to restart scripts")}catch(e){console.error("Error rerunning scripts:",e),f({variant:"destructive",title:"Script Restart Failed",description:"Failed to restart the required scripts"})}},I=async e=>{e.preventDefault(),y(!0);try{let e={};if(Object.keys(N).forEach(r=>{N[r]!==(null==h?void 0:h[r])&&(e[r]=N[r])}),0===Object.keys(e).length){f({title:"No changes detected",description:"Try changing some settings before saving"});return}let r=w(e),l=encodeURIComponent(r);if(!(await fetch("/cgi-bin/atinout_handler.sh",{method:"POST",headers:{"Content-Type":"application/json"},body:"command=".concat(l)})).ok)throw Error("Failed to save settings");await v(),m(!1),f({title:"Settings saved!",description:"The settings have been saved successfully",duration:3e3}),e.simSlot&&setTimeout(()=>{A()},3100)}catch(e){console.error("Error saving settings:",e),f({variant:"destructive",title:"Failed to save settings!",description:"An error occurred while saving the settings"})}finally{y(!1)}};return(0,i.jsxs)("div",{className:"grid grid-cols-1 grid-flow-row gap-8",children:[(0,i.jsx)(s.Zb,{children:(0,i.jsxs)("form",{onSubmit:I,children:[(0,i.jsxs)(s.Ol,{children:[(0,i.jsx)(s.ll,{children:"Network Settings"}),(0,i.jsx)(s.SZ,{children:"Change the network settings of the device."})]}),(0,i.jsx)(s.aY,{children:(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 grid-flow-row gap-6",children:[(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{htmlFor:"APN",children:"Current APN"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsx)(a.I,{type:"text",id:"APN",placeholder:"Current APN",value:N.currentAPN,onChange:e=>T("currentAPN",e.target.value)})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{htmlFor:"APN",children:"APN PDP Type"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(n.Ph,{value:N.apnPDPType,onValueChange:e=>T("apnPDPType",e),children:[(0,i.jsx)(n.i4,{children:(0,i.jsx)(n.ki,{children:N.apnPDPType?({IPV4:"IPv4 Only",IPV6:"IPv6 Only",IPV4V6:"IPv4 and IPv6",P2P:"P2P Protocol"})[e=N.apnPDPType]||e:"Select PDP Type"})}),(0,i.jsx)(n.Bw,{children:(0,i.jsxs)(n.DI,{children:[(0,i.jsx)(n.n5,{children:"PDP Type"}),(0,i.jsx)(n.Ql,{value:"IPV4",children:"IPv4 Only"}),(0,i.jsx)(n.Ql,{value:"IPV6",children:"IPv6 Only"}),(0,i.jsx)(n.Ql,{value:"IPV4V6",children:"IPv4 and IPv6"}),(0,i.jsx)(n.Ql,{value:"P2P",children:"P2P Protocol"})]})})]},"pdp-type-".concat(N.apnPDPType))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{children:"Preferred Network Type"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(n.Ph,{value:N.preferredNetworkType,onValueChange:e=>T("preferredNetworkType",e),children:[(0,i.jsx)(n.i4,{children:(0,i.jsx)(n.ki,{children:N.preferredNetworkType?({AUTO:"Automatic",LTE:"LTE Only","LTE:NR5G":"NR5G-NSA",NR5G:"NR5G-SA"})[r=N.preferredNetworkType]||r:"Select Network Type"})}),(0,i.jsx)(n.Bw,{children:(0,i.jsxs)(n.DI,{children:[(0,i.jsx)(n.n5,{children:"Preferred Network Type"}),(0,i.jsx)(n.Ql,{value:"AUTO",children:"Automatic"}),(0,i.jsx)(n.Ql,{value:"LTE",children:"LTE Only"}),(0,i.jsx)(n.Ql,{value:"LTE:NR5G",children:"NR5G-NSA"}),(0,i.jsx)(n.Ql,{value:"NR5G",children:"NR5G-SA"})]})})]},"network-type-".concat(N.preferredNetworkType))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{children:"NR5G Mode Control"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(n.Ph,{value:N.nr5gMode,onValueChange:e=>T("nr5gMode",e),children:[(0,i.jsx)(n.i4,{children:(0,i.jsx)(n.ki,{children:N.nr5gMode?({0:"NR5G-SA and NSA Enabled",1:"NR5G-NSA Only",2:"NR5G-SA Only"})[l=N.nr5gMode]||l:"Select NR5G Mode"})}),(0,i.jsx)(n.Bw,{children:(0,i.jsxs)(n.DI,{children:[(0,i.jsx)(n.n5,{children:"NR5G Mode"}),(0,i.jsx)(n.Ql,{value:"0",children:"NR5G-SA and NSA Enabled"}),(0,i.jsx)(n.Ql,{value:"1",children:"NR5G-NSA Only"}),(0,i.jsx)(n.Ql,{value:"2",children:"NR5G-SA Only"})]})})]},"nr5g-mode-".concat(N.nr5gMode))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{children:"U-SIM Slot Configuration"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(n.Ph,{value:N.simSlot,onValueChange:e=>T("simSlot",e),children:[(0,i.jsx)(n.i4,{children:(0,i.jsx)(n.ki,{children:N.simSlot?"U-SIM Slot ".concat(N.simSlot):"Select U-SIM Slot"})}),(0,i.jsx)(n.Bw,{children:(0,i.jsxs)(n.DI,{children:[(0,i.jsx)(n.n5,{children:"U-SIM Slot"}),(0,i.jsx)(n.Ql,{value:"1",children:"U-SIM Slot 1"}),(0,i.jsx)(n.Ql,{value:"2",children:"U-SIM Slot 2"})]})})]},"sim-slot-".concat(N.simSlot))]})]})}),(0,i.jsx)(s.eW,{className:"grid border-t py-4",children:(0,i.jsx)(o.z,{type:"submit",disabled:g,children:g?"Saving...":"Save"})})]})}),(0,i.jsx)(S,{})]})}},88766:function(e,r,l){"use strict";l.d(r,{O:function(){return s}});var i=l(20881),t=l(90270);function s(e){let{className:r,...l}=e;return(0,i.jsx)("div",{className:(0,t.cn)("animate-pulse rounded-md bg-primary/10",r),...l})}},36306:function(e,r,l){"use strict";l.d(r,{Z:function(){return i}});let i=(0,l(92093).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[792,59,714,217,420,72,247,985,330,744],function(){return e(e.s=51437)}),_N_E=e.O()}]);