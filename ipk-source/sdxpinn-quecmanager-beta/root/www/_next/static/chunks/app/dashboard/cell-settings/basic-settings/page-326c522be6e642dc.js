(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{51437:function(e,l,r){Promise.resolve().then(r.bind(r,80887))},80887:function(e,l,r){"use strict";r.r(l),r.d(l,{default:function(){return S}});var i=r(20881),t=r(64149),n=r(94920),s=r(22989),o=r(78580),a=r(33335),c=r(21501),d=r(88766),p=r(46646),f=()=>{let[e,l]=(0,t.useState)(null),[r,i]=(0,t.useState)(!0),n=(0,t.useCallback)(async()=>{try{i(!0);let e=await fetch("/cgi-bin/fetch_data.sh?set=2"),r=await e.json();console.log("Fetched cell settings data:",r);let t={currentAPN:u(r[0].response,r[1].response),apnPDPType:h(r[0].response),preferredNetworkType:P(r[2].response),nr5gMode:v(r[3].response),simSlot:g(r[4].response)};l(t),console.log("Processed cell settings data:",t)}catch(e){console.error("Error fetching cell settings data:",e)}i(!1)},[]);return(0,t.useEffect)(()=>{n()},[n]),{data:e,isLoading:r,fetchCellSettingsData:n}};let u=(e,l)=>{var r,i;let t=null===(r=e.split("\n").find(e=>e.includes("+CGDCONT: 1")))||void 0===r?void 0:r.split(",")[2].replace(/"/g,"");if(void 0===t||""===t){let e=null===(i=l.split("\n").find(e=>e.includes("+CGCONTRDP:")))||void 0===i?void 0:i.split(",")[2].replace(/"/g,"");return void 0===e||""===e?"No APN found":e}return t},h=e=>{var l;let r=null===(l=e.split("\n").find(e=>e.includes("+CGDCONT: 1")))||void 0===l?void 0:l.split(",")[1].replace(/"/g,"");return void 0===r||""===r?"Error fetching PDP Type":r},P=e=>{var l;let r=null===(l=e.split("\n").find(e=>e.includes('+QNWPREFCFG: "mode_pref"')))||void 0===l?void 0:l.split(",")[1].replace(/"/g,"");return void 0===r||""===r?"Error fetching network type":r},v=e=>{var l;let r=null===(l=e.split("\n").find(e=>e.includes('+QNWPREFCFG: "nr5g_disable_mode"')))||void 0===l?void 0:l.split(",")[1].replace(/"/g,"");return void 0===r||""===r?"Error fetching NR5G mode":r},g=e=>{var l;let r=null===(l=e.split("\n").find(e=>e.includes("+QUIMSLOT:")))||void 0===l?void 0:l.split(":")[1].trim();return void 0===r||""===r?"Error fetching SIM slot":r};var y=r(47657),x=r(24052),m=r(36306);let N={apn:"",pdpType:"",iccid:""},j={profile1:{...N},profile2:{...N}},w=[{value:"IPV4",label:"IPv4 Only"},{value:"IPV6",label:"IPv6 Only"},{value:"IPV4V6",label:"IPv4 and IPv6"},{value:"P2P",label:"P2P Protocol"}];var T=()=>{let{toast:e}=(0,p.pm)(),{profiles:l,isLoading:r,updateAPNProfile:f,deleteAPNProfiles:u}=function(){let[e,l]=(0,t.useState)({}),[r,i]=(0,t.useState)(!0),n=async()=>{try{i(!0);let e=await fetch("/cgi-bin/cell-settings/apn-profiles/fetch-profile.sh",{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"},signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let r=await e.json();console.log("Fetched APN profiles data:",r),l(r)}catch(e){console.error("Error fetching APN profiles:",e)}finally{i(!1)}};(0,t.useEffect)(()=>{n()},[]);let s=async(r,i)=>{try{var t,n,s,o,a,c;let d=new URLSearchParams;"profile1"===r?(d.append("iccidProfile1",i.iccid),d.append("apnProfile1",i.apn),d.append("pdpType1",i.pdpType)):(d.append("iccidProfile1",(null===(t=e.profile1)||void 0===t?void 0:t.iccid)||""),d.append("apnProfile1",(null===(n=e.profile1)||void 0===n?void 0:n.apn)||""),d.append("pdpType1",(null===(s=e.profile1)||void 0===s?void 0:s.pdpType)||"")),("profile2"===r||e.profile2)&&(d.append("iccidProfile2","profile2"===r?i.iccid:(null===(o=e.profile2)||void 0===o?void 0:o.iccid)||""),d.append("apnProfile2","profile2"===r?i.apn:(null===(a=e.profile2)||void 0===a?void 0:a.apn)||""),d.append("pdpType2","profile2"===r?i.pdpType:(null===(c=e.profile2)||void 0===c?void 0:c.pdpType)||""));let p=await fetch("/cgi-bin/cell-settings/apn-profiles/save-profile.sh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString(),signal:AbortSignal.timeout(1e4)});if(!p.ok)throw Error("Failed to update profile");let f=await p.json();if("success"===f.status)return l(e=>({...e,[r]:i})),!0;throw Error(f.message||"Failed to update profile")}catch(e){return console.error("Error updating ".concat(r,":"),e),!1}};return{profiles:e,isLoading:r,updateAPNProfile:s,deleteAPNProfiles:async()=>{try{let e=await fetch("/cgi-bin/cell-settings/apn-profiles/delete-profile.sh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error("Failed to delete profiles");let r=await e.json();if("success"===r.status)return l({}),!0;throw Error(r.message||"Failed to delete profiles")}catch(e){return console.error("Error deleting APN profiles:",e),!1}}}}(),[h,P]=(0,t.useState)(!1),[v,g]=(0,t.useState)(!1),[N,T]=(0,t.useState)(j);(0,t.useEffect)(()=>{if(l){var e,r,i,t,n,s;T({profile1:{apn:(null===(e=l.profile1)||void 0===e?void 0:e.apn)||"",pdpType:(null===(r=l.profile1)||void 0===r?void 0:r.pdpType)||"",iccid:(null===(i=l.profile1)||void 0===i?void 0:i.iccid)||""},profile2:{apn:(null===(t=l.profile2)||void 0===t?void 0:t.apn)||"",pdpType:(null===(n=l.profile2)||void 0===n?void 0:n.pdpType)||"",iccid:(null===(s=l.profile2)||void 0===s?void 0:s.iccid)||""}})}},[l]);let S=(e,l,r)=>{T(i=>({...i,[e]:{...i[e],[l]:r}}))},A=()=>N.profile1.apn&&N.profile1.pdpType&&N.profile1.iccid?!Object.values(N.profile2).some(e=>""!==e)||!!N.profile2.apn&&!!N.profile2.pdpType&&!!N.profile2.iccid||(e({variant:"destructive",title:"Invalid Profile 2",description:"All fields for Profile 2 are required if any field is filled"}),!1):(e({variant:"destructive",title:"Invalid Profile 1",description:"All fields for Profile 1 are required"}),!1),I=async l=>{if(l.preventDefault(),A()){P(!0);try{let l=await f("profile1",N.profile1),r=!Object.values(N.profile2).some(e=>""!==e)||await f("profile2",N.profile2);if(l&&r)e({title:"Success",description:"APN profiles have been saved successfully"});else throw Error("Failed to save one or more profiles")}catch(l){e({variant:"destructive",title:"Error",description:"Failed to save APN profiles. Please try again."})}finally{P(!1)}}},C=async()=>{if(confirm("Are you sure you want to delete all APN profiles?")){g(!0);try{if(await u())T(j),e({title:"Success",description:"APN profiles have been deleted successfully"});else throw Error("Failed to delete profiles")}catch(l){e({variant:"destructive",title:"Error",description:"Failed to delete APN profiles. Please try again."})}finally{g(!1)}}},b=(e,l)=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsxs)(c._,{htmlFor:"APNProfile".concat(l),children:["APN Profile ",l]}),r?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsx)(a.I,{type:"text",id:"APNProfile".concat(l),placeholder:"APN for Profile ".concat(l),value:N[e].apn,onChange:l=>S(e,"apn",l.target.value)})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{htmlFor:"PDPType".concat(l),children:"APN PDP Type"}),r?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(s.Ph,{value:N[e].pdpType,onValueChange:l=>S(e,"pdpType",l),children:[(0,i.jsx)(s.i4,{id:"PDPType".concat(l),children:(0,i.jsx)(s.ki,{placeholder:"Select PDP Type"})}),(0,i.jsx)(s.Bw,{children:(0,i.jsxs)(s.DI,{children:[(0,i.jsx)(s.n5,{children:"PDP Type"}),w.map(e=>{let{value:l,label:r}=e;return(0,i.jsx)(s.Ql,{value:l,children:r},l)})]})})]})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2 col-span-2",children:[(0,i.jsxs)(c._,{htmlFor:"ICCIDProfile".concat(l),children:["ICCID Profile ",l]}),r?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsx)(a.I,{type:"text",id:"ICCIDProfile".concat(l),placeholder:"ICCID for Profile ".concat(l),value:N[e].iccid,onChange:l=>S(e,"iccid",l.target.value)})]})]});return(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{children:[(0,i.jsx)(n.ll,{children:"APN and ICCID Profiles"}),(0,i.jsx)(n.SZ,{children:"Configure APN profiles based on SIM card ICCID. Profile 1 is required."})]}),(0,i.jsx)(n.aY,{children:(0,i.jsxs)("form",{className:"grid grid-cols-1 lg:grid-cols-2 grid-flow-row gap-6",onSubmit:I,children:[b("profile1",1),(0,i.jsx)(y.Z,{className:"col-span-2 w-full my-2"}),b("profile2",2),(0,i.jsx)("div",{className:"col-span-2",children:(0,i.jsxs)(n.eW,{className:"border-t py-4 grid md:grid-cols-2 grid-cols-1 gap-4 px-0",children:[(0,i.jsxs)(o.z,{type:"submit",disabled:h||v,children:[(0,i.jsx)(x.Z,{className:"h-4 w-4"}),h?"Saving...":"Save Profiles"]}),(0,i.jsxs)(o.z,{type:"button",variant:"secondary",onClick:C,disabled:h||v,children:[(0,i.jsx)(m.Z,{className:"h-4 w-4"}),v?"Deleting...":"Delete Profiles"]})]})})]})})]})},S=()=>{var e,l,r;let u=(0,p.pm)(),{data:h,isLoading:P,fetchCellSettingsData:v}=f(),[g,y]=(0,t.useState)(!1),[x,m]=(0,t.useState)(!1),[N,j]=(0,t.useState)({currentAPN:"",apnPDPType:"",preferredNetworkType:"",nr5gMode:"",simSlot:""});(0,t.useEffect)(()=>{if(h&&!x){let e={currentAPN:String(h.currentAPN||""),apnPDPType:String(h.apnPDPType||""),preferredNetworkType:String(h.preferredNetworkType||""),nr5gMode:String(h.nr5gMode||""),simSlot:String(h.simSlot||"")};j(e),m(!0),console.log("Initial data loaded:",e)}},[h,x]),(0,t.useEffect)(()=>{h||m(!1)},[h]);let w=e=>{let l=[];if(e.currentAPN||e.apnPDPType){let r=e.apnPDPType||N.apnPDPType,i=e.currentAPN||N.currentAPN;l.push('AT+CGDCONT=1,"'.concat(r,'","').concat(i,'"'))}if(e.preferredNetworkType){let r='+QNWPREFCFG="mode_pref",'.concat(e.preferredNetworkType);l.push(0===l.length?"AT".concat(r):r)}if(e.nr5gMode){let r='+QNWPREFCFG="nr5g_disable_mode",'.concat(e.nr5gMode);l.push(0===l.length?"AT".concat(r):r)}if(e.simSlot){let r="+QUIMSLOT=".concat(e.simSlot,";+COPS=2;+COPS=0");l.push(0===l.length?"AT".concat(r):r)}return l.join(";")},S=(e,l)=>{j(r=>({...r,[e]:l}))},A=async e=>{e.preventDefault(),y(!0);try{let e={};if(Object.keys(N).forEach(l=>{N[l]!==(null==h?void 0:h[l])&&(e[l]=N[l])}),0===Object.keys(e).length){u.toast({title:"No changes detected",description:"Try changing some settings before saving"});return}let l=w(e),r=encodeURIComponent(l);if(!(await fetch("/cgi-bin/atinout_handler.sh",{method:"POST",headers:{"Content-Type":"application/json"},body:"command=".concat(r)})).ok)throw Error("Failed to save settings");await v(),m(!1),u.toast({title:"Settings saved!",description:"The settings have been saved successfully"})}catch(e){console.error("Error saving settings:",e),u.toast({variant:"destructive",title:"Failed to save settings!",description:"An error occurred while saving the settings"})}finally{y(!1)}};return(0,i.jsxs)("div",{className:"grid grid-cols-1 grid-flow-row gap-8",children:[(0,i.jsx)(n.Zb,{children:(0,i.jsxs)("form",{onSubmit:A,children:[(0,i.jsxs)(n.Ol,{children:[(0,i.jsx)(n.ll,{children:"Network Settings"}),(0,i.jsx)(n.SZ,{children:"Change the network settings of the device."})]}),(0,i.jsx)(n.aY,{children:(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 grid-flow-row gap-6",children:[(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{htmlFor:"APN",children:"Current APN"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsx)(a.I,{type:"text",id:"APN",placeholder:"Current APN",value:N.currentAPN,onChange:e=>S("currentAPN",e.target.value)})]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{htmlFor:"APN",children:"APN PDP Type"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(s.Ph,{value:N.apnPDPType,onValueChange:e=>S("apnPDPType",e),children:[(0,i.jsx)(s.i4,{children:(0,i.jsx)(s.ki,{children:N.apnPDPType?({IPV4:"IPv4 Only",IPV6:"IPv6 Only",IPV4V6:"IPv4 and IPv6",P2P:"P2P Protocol"})[e=N.apnPDPType]||e:"Select PDP Type"})}),(0,i.jsx)(s.Bw,{children:(0,i.jsxs)(s.DI,{children:[(0,i.jsx)(s.n5,{children:"PDP Type"}),(0,i.jsx)(s.Ql,{value:"IPV4",children:"IPv4 Only"}),(0,i.jsx)(s.Ql,{value:"IPV6",children:"IPv6 Only"}),(0,i.jsx)(s.Ql,{value:"IPV4V6",children:"IPv4 and IPv6"}),(0,i.jsx)(s.Ql,{value:"P2P",children:"P2P Protocol"})]})})]},"pdp-type-".concat(N.apnPDPType))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{children:"Preferred Network Type"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(s.Ph,{value:N.preferredNetworkType,onValueChange:e=>S("preferredNetworkType",e),children:[(0,i.jsx)(s.i4,{children:(0,i.jsx)(s.ki,{children:N.preferredNetworkType?({AUTO:"Automatic",LTE:"LTE Only","LTE:NR5G":"NR5G-NSA",NR5G:"NR5G-SA"})[l=N.preferredNetworkType]||l:"Select Network Type"})}),(0,i.jsx)(s.Bw,{children:(0,i.jsxs)(s.DI,{children:[(0,i.jsx)(s.n5,{children:"Preferred Network Type"}),(0,i.jsx)(s.Ql,{value:"AUTO",children:"Automatic"}),(0,i.jsx)(s.Ql,{value:"LTE",children:"LTE Only"}),(0,i.jsx)(s.Ql,{value:"LTE:NR5G",children:"NR5G-NSA"}),(0,i.jsx)(s.Ql,{value:"NR5G",children:"NR5G-SA"})]})})]},"network-type-".concat(N.preferredNetworkType))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{children:"NR5G Mode Control"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(s.Ph,{value:N.nr5gMode,onValueChange:e=>S("nr5gMode",e),children:[(0,i.jsx)(s.i4,{children:(0,i.jsx)(s.ki,{children:N.nr5gMode?({0:"NR5G-SA and NSA Enabled",1:"NR5G-NSA Only",2:"NR5G-SA Only"})[r=N.nr5gMode]||r:"Select NR5G Mode"})}),(0,i.jsx)(s.Bw,{children:(0,i.jsxs)(s.DI,{children:[(0,i.jsx)(s.n5,{children:"NR5G Mode"}),(0,i.jsx)(s.Ql,{value:"0",children:"NR5G-SA and NSA Enabled"}),(0,i.jsx)(s.Ql,{value:"1",children:"NR5G-NSA Only"}),(0,i.jsx)(s.Ql,{value:"2",children:"NR5G-SA Only"})]})})]},"nr5g-mode-".concat(N.nr5gMode))]}),(0,i.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-2",children:[(0,i.jsx)(c._,{children:"U-SIM Slot Configuration"}),P?(0,i.jsx)(d.O,{className:"h-8"}):(0,i.jsxs)(s.Ph,{value:N.simSlot,onValueChange:e=>S("simSlot",e),children:[(0,i.jsx)(s.i4,{children:(0,i.jsx)(s.ki,{children:N.simSlot?"U-SIM Slot ".concat(N.simSlot):"Select U-SIM Slot"})}),(0,i.jsx)(s.Bw,{children:(0,i.jsxs)(s.DI,{children:[(0,i.jsx)(s.n5,{children:"U-SIM Slot"}),(0,i.jsx)(s.Ql,{value:"1",children:"U-SIM Slot 1"}),(0,i.jsx)(s.Ql,{value:"2",children:"U-SIM Slot 2"})]})})]},"sim-slot-".concat(N.simSlot))]})]})}),(0,i.jsx)(n.eW,{className:"grid border-t py-4",children:(0,i.jsx)(o.z,{type:"submit",disabled:g,children:g?"Saving...":"Save"})})]})}),(0,i.jsx)(T,{})]})}},88766:function(e,l,r){"use strict";r.d(l,{O:function(){return n}});var i=r(20881),t=r(90270);function n(e){let{className:l,...r}=e;return(0,i.jsx)("div",{className:(0,t.cn)("animate-pulse rounded-md bg-primary/10",l),...r})}},36306:function(e,l,r){"use strict";r.d(l,{Z:function(){return i}});let i=(0,r(92093).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[792,59,155,726,948,72,247,985,330,744],function(){return e(e.s=51437)}),_N_E=e.O()}]);