#!/bin/ash

echo "Stopping QuecManager Services and removing from rc.local..."

# Remove services from rc.local if present
if sed -i '/\/www\/cgi-bin\/home\/log_signal_metrics\.sh &/d' /etc/rc.local; then
    echo "Removed log_signal_metrics.sh entry from rc.local."
else
    echo "Warning: Failed to remove log_signal_metrics.sh entry or it was not found."
fi

if sed -i '/\/www\/cgi-bin\/settings\/change_sms_code\.sh &/d' /etc/rc.local; then
    echo "Removed change_sms_code.sh entry from rc.local."
else
    echo "Warning: Failed to remove change_sms_code.sh entry or it was not found."
fi

# Define a list of scripts to check and stop
SCRIPTS="
/www/cgi-bin/home/log_signal_metrics.sh
"

# Loop through each script, check if it's running, and kill it if necessary
echo "Checking and stopping running scripts..."
for SCRIPT in $SCRIPTS; do
    PID=$(pgrep -f "$SCRIPT")
    if [ -n "$PID" ]; then
        echo "Stopping $SCRIPT (PID: $PID)..."
        if kill -TERM "$PID"; then
            echo "Successfully stopped $SCRIPT."
        else
            echo "Error: Failed to stop $SCRIPT."
        fi
    else
        echo "$SCRIPT is not running. Nothing to stop."
    fi
done

service quecmanager-services stop 
service quecmanager-services disable

echo "Cleanup complete."
exit 0

