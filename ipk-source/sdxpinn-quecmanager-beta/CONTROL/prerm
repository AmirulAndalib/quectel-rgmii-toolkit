#!/bin/ash

echo "Stopping QuecManager Services and removing from rc.local..."

# Remove services from rc.local if present
sed -i '/\/www\/cgi-bin\/home\/log_signal_metrics\.sh &/d' /etc/rc.local
sed -i '/\/www\/cgi-bin\/settings\/change_sms_code\.sh &/d' /etc/rc.local

# Define an array of scripts to check and stop
SCRIPTS=(
    "/www/cgi-bin/home/log_signal_metrics.sh"
    "/www/cgi-bin/settings/change_sms_code.sh"
)

# Loop through each script, check if it's running, and kill it if necessary
for SCRIPT in "${SCRIPTS[@]}"; do
    PID=$(pgrep -f "$SCRIPT")
    if [ -n "$PID" ]; then
        echo "Stopping $SCRIPT (PID: $PID)..."
        if kill -TERM "$PID"; then
            echo "Successfully stopped $SCRIPT."
        else
            echo "Failed to stop $SCRIPT."
        fi
    else
        echo "$SCRIPT is not running. Nothing to stop."
    fi
done

exit 0

