#!/bin/bash

DEVICE=/dev/ttyOUT2
BAUD=115200
TIMEOUT_DURATION=5 # Seconds to wait for a response

# Setup device
stty -F $DEVICE cs8 $BAUD ignbrk -brkint -icrnl -imaxbel -opost -onlcr -isig -icanon -iexten -echo -echoe -echok -echoctl -echoke noflsh -ixon -crtscts

echo -e "\033[0;36mType 'exit' to end the session.\033[0m"
while true; do
    echo -en "\033[0;36mEnter AT Command: \033[0m"
    read user_input

    if [[ "$user_input" == "exit" ]]; then
        echo -e "\033[0;32mExiting...\033[0m"
        exit 0
    fi

    # Send command to the device
    echo -e "$user_input\r" > $DEVICE

    # Use timeout to read the device's output and ensure it doesn't hang
    response=$(timeout $TIMEOUT_DURATION cat $DEVICE)

    echo -en "\033[0;32m$response\033[0m"

done
