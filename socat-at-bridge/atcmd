#!/bin/bash

while true; do
    echo "Type \"exit\" to end the session"
    echo "Enter AT Command:"

    read user_input

    if [[ "$user_input" == "exit" ]]; then
        echo "Exiting..."
        exit 0
    else
        # Create a temporary file for the command
        tmpcmd=$(mktemp /tmp/command.XXXXXX)

        # Write user command to the temporary file
        echo "$user_input" > "$tmpcmd"

        # Use microcom to send the command to the device
        microcom -s 115200 /dev/ttyOUT2 < "$tmpcmd"

        # Cleanup
        rm "$tmpcmd"
    fi
done
